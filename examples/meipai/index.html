<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>热门 - 美拍</title>
    <script src="https://cdn.staticfile.org/Base64/1.0.2/base64.min.js"></script>
    <script src="https://cdn.staticfile.org/urljs/2.3.1/url.min.js"></script>
    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.js"></script>
    <script src="js/meipaiParser.js"></script>
    <style>
        ::-webkit-scrollbar {
            display: none
        }

        html,
        body,
        #view {
            margin: 0px;
            padding: 0px;
            width: 100%;
        }

        .video {
            margin: 10px;
            width: 240px;
        }
    </style>
</head>

<body>
    <div id="view"></div>
    <script type="text/javascript">
        var proxyBaseApi = "http://127.0.0.1:8081"
        // 代理ajax
        function proxyAjax(url, option, callback) {
            $.ajax({
                url: `${proxyBaseApi}/${url}`,
                type: 'POST',
                data: JSON.stringify(option),
                success: function (result, textStatus, jqXHR) {
                    if (textStatus === "success") {
                        typeof callback == "function" ? callback(result) : null;
                    } else {
                        console.error("接口访问失败", result);
                    }
                },
                error: function (res, textStatus) {
                    console.error("Ajax代理服务器访问失败");
                }
            });
        }
        $("body").ready(function () {
            // 初始配置
            var query = {
                page: 2, //页号
                count: 24, //分页大小
                tid: 474, //类型ID
                single_column: 1 //是否有水印
            };
            // https://www.meipai.com/squares/new_timeline?page=2&count=24&tid=474&single_column=1 // 最新高颜值无水印
            proxyAjax(`https/www.meipai.com/squares/new_timeline?${Url.stringify(query)}`, {}, function (re) {
                var medias = re ? re.medias : [];
                var $view = $("#view");
                medias.map(function (e) {
                    var src = meipaiParser.decodeMp4.decode(e.video);
                    var $video = $(
                        `<video id=${e.id} class="video" poster="${e.convert_cover_pic||e.cover_pic}!thumb320" data-src=${src} autoplay></video>`
                    );
                    $video.on("click", function () {
                        $(this).attr("src", $(this).attr("data-src"));
                    });
                    $view.append($video);
                });
            });
        });
    </script>
</body>

</html>